<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sound Space Custom Maps</title>
  <style>
    /* --- Base Styling --- */
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at top, #0e0f1a 0%, #05060a 100%);
      color: #e5e5e5;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* --- Notice Bar --- */
    .notice {
      text-align: center;
      background: linear-gradient(90deg, #ff004c, #ff6600);
      color: #fff;
      font-weight: bold;
      padding: 10px;
      font-size: 14px;
      text-shadow: 0 0 5px #000;
      box-shadow: 0 0 12px rgba(0,0,0,0.5);
    }

    h1 {
      text-align: center;
      font-size: 2.2em;
      margin: 20px 0 10px;
      color: #00f5d4;
      text-shadow: 0 0 10px #00f5d4, 0 0 20px #00bfa5;
      letter-spacing: 1px;
    }

    header {
      padding: 15px;
      border-bottom: 1px solid #1f2230;
      background: rgba(10, 12, 20, 0.85);
      backdrop-filter: blur(6px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* --- Search Box --- */
    .search-bar {
      display: flex;
      justify-content: center;
      margin: 10px auto 0;
      max-width: 600px;
      width: 100%;
    }

    .search-bar input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 8px 0 0 8px;
      border: none;
      outline: none;
      font-size: 15px;
      background: #0e111c;
      color: #f5f5f5;
      box-shadow: inset 0 0 5px #000;
    }

    .search-bar select {
      padding: 10px;
      border-radius: 0 8px 8px 0;
      border: none;
      background: #1b1f2e;
      color: #e5e5e5;
      font-size: 14px;
      cursor: pointer;
    }

    /* --- Map List --- */
    .map-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      padding: 20px;
      flex: 1;
    }

    /* --- Map Cards --- */
    .map-card {
      background: linear-gradient(145deg, #151822, #0b0c14);
      border: 1px solid #1e2132;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 0 12px rgba(0,0,0,0.6);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .map-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(0,255,200,0.3), 0 0 40px rgba(0,255,180,0.15);
    }

    .map-card h2 {
      margin: 0 0 8px;
      font-size: 18px;
      color: #ffcc00;
      text-shadow: 0 0 5px #ffcc00, 0 0 10px #ff8800;
    }

    .map-card p {
      margin: 4px 0;
      font-size: 14px;
    }

    /* --- Copy Button --- */
    button {
      margin-top: 10px;
      background: #00f5d4;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s ease;
      color: #0b0c14;
      width: 100%;
    }

    button:hover {
      background: #00c9a7;
      box-shadow: 0 0 8px #00f5d4;
    }

    button.copied {
      background: #66ff66 !important;
      color: #000 !important;
      box-shadow: 0 0 10px #66ff66;
    }

    footer {
      text-align: center;
      padding: 12px;
      font-size: 12px;
      color: #666;
      border-top: 1px solid #1f2230;
      background: #090a10;
    }
  </style>
</head>
<body>
  <!-- ✅ Notice bar at very top -->
  <div class="notice">
    If there is a map with incorrect data or you would like extra credit towards your map,  
    please DM me on Discord <b>@redduy35</b>
  </div>

  <header>
    <h1>🎵 Sound Space Custom Maps 🎵</h1>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by artist, title, or mapper...">
      <select id="searchField">
        <option value="all">All</option>
        <option value="artist">Artist</option>
        <option value="title">Title</option>
        <option value="mapper">Mapper</option>
      </select>
    </div>
  </header>

  <div id="maps" class="map-list"></div>

  <footer>Sound Space Maps Viewer | Powered by GitHub Pages</footer>

  <script>
    const repoOwner = "redwywy2013";
    const repoName = "Sound-Space-Maps";
    const folder = "maps";

    const container = document.getElementById("maps");
    const searchInput = document.getElementById("searchInput");
    const searchField = document.getElementById("searchField");

    function parseSSCM(text) {
      const data = {};
      text.split("\n").forEach(line => {
        if (line.startsWith("Map Data:")) {
          data.mapData = line.replace("Map Data:", "").trim();
        } else if (line.startsWith("Artist & Title:")) {
          data.song = line.replace("Artist & Title:", "").trim();
          const parts = data.song.split(" - ");
          data.artist = parts.length > 1 ? parts[0] : "";
          data.title = parts.length > 1 ? parts.slice(1).join(" - ") : parts[0];
        } else if (line.startsWith("Mapper:")) {
          data.mapper = line.replace("Mapper:", "").trim();
        }
      });
      return data;
    }

    async function loadMaps() {
      try {
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}`;
        const res = await fetch(apiUrl);
        const files = await res.json();
        const sscmFiles = files.filter(f => f.name.endsWith(".sscm"));

        for (let i = 0; i < sscmFiles.length; i++) {
          const file = sscmFiles[i];
          const resFile = await fetch(file.download_url);
          const text = await resFile.text();
          const map = parseSSCM(text);

          const card = document.createElement("div");
          card.className = "map-card";
          card.dataset.artist = map.artist.toLowerCase();
          card.dataset.title = map.title.toLowerCase();
          card.dataset.mapper = map.mapper.toLowerCase();

          card.innerHTML = `
            <h2>${map.song}</h2>
            <p><b>Mapper:</b> ${map.mapper}</p>
            <button id="btn-${i}" onclick="copyMap('${map.mapData}', 'btn-${i}')">Copy Map Data</button>
          `;
          container.appendChild(card);
        }
      } catch (err) {
        console.error("Error loading maps:", err);
      }
    }

    async function copyMap(urlOrData, btnId) {
      const button = document.getElementById(btnId);
      try {
        let text = urlOrData;
        if (/^https?:\/\//i.test(urlOrData)) {
          const res = await fetch(urlOrData);
          text = await res.text();
        }
        await navigator.clipboard.writeText(text);
        button.textContent = "✅ Copied Successfully!";
        button.classList.add("copied");

        setTimeout(() => {
          button.textContent = "Copy Map Data";
          button.classList.remove("copied");
        }, 2000);
      } catch (err) {
        button.textContent = "❌ Copy Failed";
        setTimeout(() => { button.textContent = "Copy Map Data"; }, 2000);
      }
    }

    // --- Search filter ---
    searchInput.addEventListener("input", filterMaps);
    searchField.addEventListener("change", filterMaps);

    function filterMaps() {
      const query = searchInput.value.toLowerCase();
      const field = searchField.value;
      const cards = document.querySelectorAll(".map-card");

      cards.forEach(card => {
        let show = false;
        if (!query) {
          show = true;
        } else if (field === "all") {
          show =
            card.dataset.artist.includes(query) ||
            card.dataset.title.includes(query) ||
            card.dataset.mapper.includes(query);
        } else {
          show = card.dataset[field].includes(query);
        }
        card.style.display = show ? "block" : "none";
      });
    }

    loadMaps();
  </script>
</body>
</html>
